language: go

go:
  - "1.7.1"

env:
  global:
    - secure: "fPybaSk9QAjrShF1Xsz7DTfckvYg/US5EtCvxBs3Y/NBUEKCjVDx/hQrWohjIJiYljVwIwEMFNeuLKTlK9Iy8mFO6rbPo2WryxnV2eQ6CpyIm4biooj538rK47XapRgGfTwCSv1NoYC4czVIBrWA60MMYMkxaNm8/Jp4CTkFbmw3hAbmloWQptND7oGJaN0zbnaZjAKoi8y6fu8k2uvsqIWVyTJAiNN1glmlU2n+YY9nGFtXlNOuPp2JX5ppQ8l54kaNYu8vuVZVqLb34tODt1JUwUIr3DWh78XA9/h4TTMAE1rULWG9srPkPBSwusjX7DsIouSSU5cNn25IXcqZ774Dxrs5/A/qWc1K/I4Q3E4gDW1uP9Xv12tPyYuSk2I3CYH2tdmJ+EhTghe7LJQY2pa7p6y0OCVHFsGNoNKFwz4eLdwrLLv+XekLWy8o60ekJ0zkZlGgMGah/Hu37EPKQNKARKMOVGCl5GendHPHpL6OB1SG3Ku+KwWUL4CLIXONo5K7085t7/oaQzTna5bftJTsZBeUlCZV3hEaWN6DCjdhK8zE/OqYDXiTexZ8jQhO82lp9n0A7094vsl13xify8FEtrtKsODk+0FQuq4NFA+gMQ9GNWWGZffGfPbpp0Cjq5kg8BoL7jmucZbHAOT44DVWSdr5MeG1b4HVZI3DBks="
    - GIT_DEPLOY_USERNAME="Simon Seyer"
    - GIT_DEPLOY_EMAIL="simon.seyer@gmail.com"
    - GIT_DEPLOY_DIR=docs
    - GIT_DEPLOY_BRANCH=master

cache: 
  directories:
    - tmp/image_cache
    - vendor/bundle
    - $GOPATH

install:
  - bundle install --deployment

before_script:
  - go get -v github.com/spf13/hugo

script:
  - hugo
  - ./scripts/resize_images.sh
  - bundle exec image_optim -r --cache-dir tmp/image_cache $GIT_DEPLOY_DIR

after_success:
  - ./scripts/deploy.sh
